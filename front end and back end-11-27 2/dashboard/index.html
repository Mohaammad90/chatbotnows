<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… â€“ ACS PRO</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <link rel="stylesheet" href="../style.css" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="../auth/auth.js"></script>

  <style>
    body {
      margin: 0;
      background: linear-gradient(180deg,#f7f7fa 0%, #f0f1f5 100%);
      color: #1d1d1f;
      font-family: "SF Pro Display", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    .page {
      max-width: 1200px;
      margin: 0 auto;
      padding: 32px 16px 80px;
    }

    .page-title {
      font-size: 28px;
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
      letter-spacing: -0.02em;
    }

    .page-subtitle {
      font-size: 15px;
      color: #6e6e73;
      margin-bottom: 24px;
    }

    .bots-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px,1fr));
      gap: 18px;
    }

    .bot-card {
      background: #ffffff;
      border-radius: 18px;
      padding: 18px;
      border: 1px solid rgba(0,0,0,0.06);
      box-shadow: 0 20px 60px rgba(0,0,0,0.08);
    }

    .bot-title {
      font-size: 17px;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .bot-meta {
      font-size: 12px;
      color: #6e6e73;
      margin-bottom: 12px;
    }

    .badge {
      display: inline-block;
      padding: 4px 12px;
      font-size: 11px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,0.08);
      margin-bottom: 10px;
      background: #f5f5f7;
      color: #1d1d1f;
    }

    .bot-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .btn-small {
      padding: 9px 16px;
      background: #ffffff;
      border: 1px solid rgba(0,0,0,0.08);
      color: #1d1d1f;
      border-radius: 12px;
      font-size: 12px;
      cursor: pointer;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 12px 28px rgba(0,0,0,0.06);
    }

    .btn-small:hover {
      color: #0a84ff;
      border-color: rgba(10,132,255,0.35);
    }

    .btn-primary {
      background: linear-gradient(145deg,#0a84ff,#1d7bff);
      border: none !important;
      color: #fff;
      font-weight: 600;
      box-shadow: 0 16px 44px rgba(10,132,255,0.28);
    }

    .telegram-link {
      margin-top: 8px;
      font-size: 12px;
      color: #0a84ff;
      word-break: break-all;
    }
  </style>
</head>
<body>

  <!-- User bar -->
  <div id="user-bar" style="padding: 16px 24px;"></div>

  <div class="page">

    <div class="page-title">ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</div>
    <div class="page-subtitle">
      Ù‡Ù†Ø§ ØªØ¬Ø¯ ÙƒÙ„ Ø§Ù„Ø¨ÙˆØªØ§Øª Ø§Ù„ØªÙŠ Ø£Ù†Ø´Ø£ØªÙ‡Ø§. ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§ØŒ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù†Ø´Ø±ØŒ Ø£Ùˆ Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙˆØª Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨.
    </div>

    <div style="margin-bottom:20px;">
      <a class="btn-small btn-primary" href="../bot-editor/index.html">
        â• Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙˆØª Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨
      </a>
    </div>

    <div id="botsContainer" class="bots-grid"></div>

  </div>

  <script>
    async function loadBots() {
      const supabase = window.supabaseClient;
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) return;

      let result = await supabase
        .from("bots")
        .select("*")
        .eq("user_id", user.id)
        .order("created_at", { ascending: false });

      const container = document.getElementById("botsContainer");
      container.innerHTML = "";

      if (!result.data || result.data.length === 0) {
        container.innerHTML = `
          <div style="color:#9ca3af; font-size:14px;">
            Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙˆØªØ§Øª Ø¨Ø¹Ø¯. Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± "Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙˆØª Ø¬Ø¯ÙŠØ¯".
          </div>
        `;
        return;
      }

      result.data.forEach(bot => {
        const deployed = bot.telegram_enabled || bot.deployed_at;
        const startLink = bot.telegram_start_link || "";

        const card = document.createElement("div");
        card.className = "bot-card";

        card.innerHTML = `
          <div class="bot-title">${bot.bot_name}</div>
          <div class="bot-meta">Ø§Ù„Ù‚Ø§Ù„Ø¨: ${bot.template}</div>

          ${deployed
            ? `<div class="badge" style="border-color:#4ade80; color:#4ade80;">âœ” Ø¬Ø§Ù‡Ø² Ù„Ù„Ù†Ø´Ø±</div>`
            : `<div class="badge">Ù…Ø³ÙˆØ¯Ø©</div>`}

          <div class="bot-actions">
            <a href="../bot-editor/restaurant.html?bot_id=${bot.id}" class="btn-small">
              âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙˆØª
            </a>

            <button class="btn-small btn-primary" onclick="openDeploy('${bot.id}')">
              ğŸš€ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø´Ø±
            </button>
          </div>

          ${startLink
            ? `<div class="telegram-link">ğŸ”— Ø±Ø§Ø¨Ø· ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ: ${startLink}</div>`
            : ""}
        `;

        container.appendChild(card);
      });
    }

    function openDeploy(botId) {
      // Go to deploy page with this bot_id
      window.location.href = `../deploy/index.html?bot_id=${encodeURIComponent(botId)}`;
    }

    document.addEventListener("DOMContentLoaded", async () => {
      await window.acsAuth.requireAuth();
      loadBots();
    });
  </script>

</body>
</html>